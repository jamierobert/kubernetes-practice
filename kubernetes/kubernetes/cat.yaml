groups:
- name: ALL
  jobs:
  - build-code-TRUSS_245
  - security-scan-TRUSS_245
  - build-docker-image-TRUSS_245
  - test-docker-image-TRUSS_245
  - deploy-eks-TRUSS_245
  - bdd-test-TRUSS_245
  - performance-test-TRUSS_245
  - merge-TRUSS_245
  - create-merge-request-TRUSS_245
  - release-TRUSS_245
  - cleanup-TRUSS_245
  - build-code-TRUSS_255
  - security-scan-TRUSS_255
  - build-docker-image-TRUSS_255
  - test-docker-image-TRUSS_255
  - deploy-eks-TRUSS_255
  - bdd-test-TRUSS_255
  - performance-test-TRUSS_255
  - merge-TRUSS_255
  - create-merge-request-TRUSS_255
  - release-TRUSS_255
  - cleanup-TRUSS_255
  - build-code-TRUSS_256
  - security-scan-TRUSS_256
  - build-docker-image-TRUSS_256
  - test-docker-image-TRUSS_256
  - deploy-eks-TRUSS_256
  - bdd-test-TRUSS_256
  - performance-test-TRUSS_256
  - merge-TRUSS_256
  - create-merge-request-TRUSS_256
  - release-TRUSS_256
  - cleanup-TRUSS_256
- name: TRUSS_245
  jobs:
  - build-code-TRUSS_245
  - security-scan-TRUSS_245
  - build-docker-image-TRUSS_245
  - test-docker-image-TRUSS_245
  - deploy-eks-TRUSS_245
  - bdd-test-TRUSS_245
  - performance-test-TRUSS_245
  - merge-TRUSS_245
  - create-merge-request-TRUSS_245
  - release-TRUSS_245
  - cleanup-TRUSS_245
- name: TRUSS_255
  jobs:
  - build-code-TRUSS_255
  - security-scan-TRUSS_255
  - build-docker-image-TRUSS_255
  - test-docker-image-TRUSS_255
  - deploy-eks-TRUSS_255
  - bdd-test-TRUSS_255
  - performance-test-TRUSS_255
  - merge-TRUSS_255
  - create-merge-request-TRUSS_255
  - release-TRUSS_255
  - cleanup-TRUSS_255
- name: TRUSS_256
  jobs:
  - build-code-TRUSS_256
  - security-scan-TRUSS_256
  - build-docker-image-TRUSS_256
  - test-docker-image-TRUSS_256
  - deploy-eks-TRUSS_256
  - bdd-test-TRUSS_256
  - performance-test-TRUSS_256
  - merge-TRUSS_256
  - create-merge-request-TRUSS_256
  - release-TRUSS_256
  - cleanup-TRUSS_256
resources:
- name: app-image-master-TRUSS_245
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/category-v1-app
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: app-image-master-TRUSS_255
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/category-v1-app
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: app-image-master-TRUSS_256
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/category-v1-app
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: app-image-TRUSS_245
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_245
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: app-image-TRUSS_255
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_255
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: app-image-TRUSS_256
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_256
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: base-image-TRUSS_245
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/whc_trading_java
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: base-image-TRUSS_255
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/whc_trading_java
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: base-image-TRUSS_256
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/whc_trading_java
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
  icon: docker
- name: bdd-test-pack-code-TRUSS_245
  type: git
  source:
    branch: feature/TRUSS-247-Specify-tests-to-fit-new-contract
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/bdd/trading-distribution-bdd-category-v1.git
  tags:
  - dev
  icon: gitlab
- name: bdd-test-pack-code-TRUSS_255
  type: git
  source:
    branch: develop
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/bdd/trading-distribution-bdd-category-v1.git
  tags:
  - dev
  icon: gitlab
- name: bdd-test-pack-code-TRUSS_256
  type: git
  source:
    branch: feature/TRUSS-247-category-tests
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/bdd/trading-distribution-bdd-category-v1.git
  tags:
  - dev
  icon: gitlab
- name: chartmuseum-TRUSS_245
  type: chartmuseum-resource-TRUSS_245
  source:
    chart_name: category-v1
    helm_repositories:
      releases: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/releases/trading
      snapshots: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      stable: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/external/kubernetes-stable
    server_url: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading/
  tags:
  - dev
- name: chartmuseum-TRUSS_255
  type: chartmuseum-resource-TRUSS_255
  source:
    chart_name: category-v1
    helm_repositories:
      releases: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/releases/trading
      snapshots: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      stable: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/external/kubernetes-stable
    server_url: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading/
  tags:
  - dev
- name: chartmuseum-TRUSS_256
  type: chartmuseum-resource-TRUSS_256
  source:
    chart_name: category-v1
    helm_repositories:
      releases: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/releases/trading
      snapshots: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      stable: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/external/kubernetes-stable
    server_url: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading/
  tags:
  - dev
- name: ci-code-TRUSS_245
  type: git
  source:
    branch: master
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/global-trading-platform/ci-cd/gtp_concourse_jobs.git
  tags:
  - dev
  icon: gitlab
- name: ci-code-TRUSS_255
  type: git
  source:
    branch: master
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/global-trading-platform/ci-cd/gtp_concourse_jobs.git
  tags:
  - dev
  icon: gitlab
- name: ci-code-TRUSS_256
  type: git
  source:
    branch: master
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/global-trading-platform/ci-cd/gtp_concourse_jobs.git
  tags:
  - dev
  icon: gitlab
- name: code-develop-TRUSS_245
  type: git
  source:
    branch: develop
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: code-develop-TRUSS_255
  type: git
  source:
    branch: develop
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: code-develop-TRUSS_256
  type: git
  source:
    branch: develop
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: code-TRUSS_245
  type: git
  source:
    branch: feature/TRUSS-245
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: code-TRUSS_255
  type: git
  source:
    branch: feature/TRUSS-255
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: code-TRUSS_256
  type: git
  source:
    branch: feature/TRUSS-256
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: helm-chart-TRUSS_245
  type: helm-chart-deployment-TRUSS_245
  source:
    cluster_name: trading-eks
    helm_repositories:
      releases: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/releases/trading
      snapshots: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      stable: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/external/kubernetes-stable
    region: eu-west-1
  tags:
  - dev
- name: helm-chart-TRUSS_255
  type: helm-chart-deployment-TRUSS_255
  source:
    cluster_name: trading-eks
    helm_repositories:
      releases: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/releases/trading
      snapshots: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      stable: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/external/kubernetes-stable
    region: eu-west-1
  tags:
  - dev
- name: helm-chart-TRUSS_256
  type: helm-chart-deployment-TRUSS_256
  source:
    cluster_name: trading-eks
    helm_repositories:
      releases: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/releases/trading
      snapshots: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      stable: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/external/kubernetes-stable
    region: eu-west-1
  tags:
  - dev
- name: helm-TRUSS_245
  type: git
  source:
    branch: feature/TRUSS-245
    paths:
    - chart/*
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: helm-TRUSS_255
  type: git
  source:
    branch: feature/TRUSS-255
    paths:
    - chart/*
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: helm-TRUSS_256
  type: git
  source:
    branch: feature/TRUSS-256
    paths:
    - chart/*
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
  tags:
  - dev
  icon: gitlab
- name: jira-TRUSS_245
  type: jira-resource-TRUSS_245
  source:
    password: ((service_account_password))
    url: https://jira.willhillatlas.com
    username: ((service_account_username))
  tags:
  - dev
  icon: jira
- name: jira-TRUSS_255
  type: jira-resource-TRUSS_255
  source:
    password: ((service_account_password))
    url: https://jira.willhillatlas.com
    username: ((service_account_username))
  tags:
  - dev
  icon: jira
- name: jira-TRUSS_256
  type: jira-resource-TRUSS_256
  source:
    password: ((service_account_password))
    url: https://jira.willhillatlas.com
    username: ((service_account_username))
  tags:
  - dev
  icon: jira
- name: metadata-TRUSS_245
  type: metadata-dump-TRUSS_245
  source: {}
  tags:
  - dev
- name: metadata-TRUSS_255
  type: metadata-dump-TRUSS_255
  source: {}
  tags:
  - dev
- name: metadata-TRUSS_256
  type: metadata-dump-TRUSS_256
  source: {}
  tags:
  - dev
- name: notify-TRUSS_245
  type: slack-TRUSS_245
  source:
    url: ((slack_webhook))
  tags:
  - dev
  icon: slack
- name: notify-TRUSS_255
  type: slack-TRUSS_255
  source:
    url: ((slack_webhook))
  tags:
  - dev
  icon: slack
- name: notify-TRUSS_256
  type: slack-TRUSS_256
  source:
    url: ((slack_webhook))
  tags:
  - dev
  icon: slack
- name: performance-test-pack-code-TRUSS_245
  type: git
  source:
    branch: develop
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/pt/placeholder.git
  tags:
  - dev
  icon: gitlab
- name: performance-test-pack-code-TRUSS_255
  type: git
  source:
    branch: develop
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/pt/category-v1-performance.git
  tags:
  - dev
  icon: gitlab
- name: performance-test-pack-code-TRUSS_256
  type: git
  source:
    branch: develop
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/pt/placeholder.git
  tags:
  - dev
  icon: gitlab
- name: trading-uber-chart-TRUSS_245
  type: git
  source:
    branch: master
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/global-trading-platform/trading-uber-chart.git
  tags:
  - dev
  icon: gitlab
- name: trading-uber-chart-TRUSS_255
  type: git
  source:
    branch: master
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/global-trading-platform/trading-uber-chart.git
  tags:
  - dev
  icon: gitlab
- name: trading-uber-chart-TRUSS_256
  type: git
  source:
    branch: master
    private_key: ((gitlab_key))
    uri: git@git.nonprod.williamhill.plc:trading_development/global-trading-platform/trading-uber-chart.git
  tags:
  - dev
  icon: gitlab
resource_types:
- name: chartmuseum-resource-TRUSS_245
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-chartmuseum-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: chartmuseum-resource-TRUSS_255
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-chartmuseum-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: chartmuseum-resource-TRUSS_256
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-chartmuseum-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: helm-chart-deployment-TRUSS_245
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-helm-chart-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: helm-chart-deployment-TRUSS_255
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-helm-chart-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: helm-chart-deployment-TRUSS_256
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-helm-chart-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: jira-resource-TRUSS_245
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-jira-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: jira-resource-TRUSS_255
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-jira-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: jira-resource-TRUSS_256
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-jira-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: metadata-dump-TRUSS_245
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-metadata-dump-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: metadata-dump-TRUSS_255
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-metadata-dump-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: metadata-dump-TRUSS_256
  type: docker-image
  source:
    insecure_registries:
    - docker-registry.prod.williamhill.plc
    password: ((service_account_password))
    repository: docker-registry.prod.williamhill.plc/trading/concourse-metadata-dump-resource
    tag: latest
    username: ((service_account_username))
  tags:
  - dev
- name: slack-TRUSS_245
  type: docker-image
  source:
    repository: cfcommunity/slack-notification-resource
    tag: latest
  tags:
  - dev
- name: slack-TRUSS_255
  type: docker-image
  source:
    repository: cfcommunity/slack-notification-resource
    tag: latest
  tags:
  - dev
- name: slack-TRUSS_256
  type: docker-image
  source:
    repository: cfcommunity/slack-notification-resource
    tag: latest
  tags:
  - dev
jobs:
- name: build-code-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_255
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
      - get: metadata-TRUSS_255
        tags:
        - dev
  - task: prepare-slack-start-message
    file: ci-code-TRUSS_255/pipelines/tasks/maven/build-start-slack.yaml
    vars:
      branch: feature/TRUSS-255
      project_name: category-v1
    input_mapping:
      code: code-TRUSS_255
    tags:
    - dev
  - put: notify-TRUSS_255
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  - task: maven-build
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/maven/build.yaml
    input_mapping:
      code: code-TRUSS_255
      metadata: metadata-TRUSS_255
    tags:
    - dev
    attempts: 2
  - try:
      task: code-analysis
      file: ci-code-TRUSS_255/pipelines/tasks/maven/sonar.yaml
      vars:
        version: TRUSS-255
      tags:
      - dev
  on_abort:
    task: prepare-slack-abort-message
    file: ci-code-TRUSS_255/pipelines/tasks/slack/general-abort.yaml
    vars:
      branch: feature/TRUSS-255
      project_name: category-v1
    tags:
    - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_255/pipelines/tasks/slack/general-failure.yaml
    vars:
      branch: feature/TRUSS-255
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_255
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_255/pipelines/tasks/maven/build-finish-slack.yaml
    vars:
      branch: feature/TRUSS-255
      project_name: category-v1
    input_mapping:
      code: code-TRUSS_255
    tags:
    - dev
- name: security-scan-TRUSS_255
  public: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_255
        passed:
        - build-code-TRUSS_255
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
  - task: security-scan
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/security-scan.yaml
    input_mapping:
      code: code-TRUSS_255
    tags:
    - dev
- name: build-docker-image-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_255
        passed:
        - build-code-TRUSS_255
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
      - get: metadata-TRUSS_255
        tags:
        - dev
  - task: deploy
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/maven/deploy.yaml
    input_mapping:
      code: code-TRUSS_255
      metadata: metadata-TRUSS_255
    tags:
    - dev
  - get: base-image-TRUSS_255
    params:
      save: true
    tags:
    - dev
  - put: app-image-TRUSS_255
    params:
      additional_tags: output/additional_tags
      build: output/category-v1-app
      cache_from:
      - base-image-TRUSS_255
      tag_as_latest: true
    get_params:
      skip_download: true
    tags:
    - dev
  on_failure:
    do:
    - task: prepare-slack-failure-message
      file: ci-code-TRUSS_255/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-255
        project_name: category-v1
      tags:
      - dev
    - put: notify-TRUSS_255
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
- name: test-docker-image-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_255
        passed:
        - build-docker-image-TRUSS_255
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
      - get: app-image-TRUSS_255
        passed:
        - build-docker-image-TRUSS_255
        trigger: true
        params:
          save: true
        tags:
        - dev
  - task: test
    privileged: true
    file: code-TRUSS_255/ci/image-smoke-test.yaml
    vars:
      image-name: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_255:latest
    input_mapping:
      code: code-TRUSS_255
      image: app-image-TRUSS_255
    tags:
    - dev
  on_failure:
    do:
    - task: prepare-slack-failure-message
      file: ci-code-TRUSS_255/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-255
        project_name: category-v1
      tags:
      - dev
    - put: notify-TRUSS_255
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
- name: deploy-eks-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: app-image-TRUSS_255
        passed:
        - test-docker-image-TRUSS_255
        trigger: true
        tags:
        - dev
      - get: code-TRUSS_255
        passed:
        - test-docker-image-TRUSS_255
        tags:
        - dev
      - get: helm-TRUSS_255
        tags:
        - dev
      - get: trading-uber-chart-TRUSS_255
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
  - task: maven-version-TRUSS_255
    file: ci-code-TRUSS_255/pipelines/tasks/maven/version.yaml
    input_mapping:
      code: code-TRUSS_255
    tags:
    - dev
  - put: chartmuseum-TRUSS_255
    params:
      app_version_file: version/maven.version
      chart_path: helm-TRUSS_255/chart/category-v1
      child_of:
      - snapshots/truss_255-trading-stack:latest
      - releases/trading-stack:latest
      force: true
      rename_parent_to: truss_255-trading-stack
    tags:
    - dev
  - put: helm-chart-dry-run-TRUSS_255
    resource: helm-chart-TRUSS_255
    params:
      chart_name: truss_255-trading-stack
      chart_repo: snapshots
      debug: true
      dry_run: true
      namespace: truss_255
      namespace_labels:
        istio-injection: enabled
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_255
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_255
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_255
        category-v1.images.tag: latest
        global.cluster: trading-eks
        global.namespace: truss_255
      values_files:
      - trading-uber-chart-TRUSS_255/envs/dev/values.yaml
      version: latest
    tags:
    - dev
  - put: helm-chart-plan-TRUSS_255
    resource: helm-chart-TRUSS_255
    params:
      chart_name: truss_255-trading-stack
      chart_repo: snapshots
      namespace: truss_255
      namespace_labels:
        istio-injection: enabled
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_255
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_255
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_255
        category-v1.images.tag: latest
        global.cluster: trading-eks
        global.namespace: truss_255
      try_install: true
      values_files:
      - trading-uber-chart-TRUSS_255/envs/dev/values.yaml
      version: latest
    tags:
    - dev
  - put: helm-chart-apply-TRUSS_255
    resource: helm-chart-TRUSS_255
    params:
      chart_name: truss_255-trading-stack
      chart_repo: snapshots
      namespace: truss_255
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_255
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_255
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_255
        category-v1.images.tag: latest
      version: latest
    tags:
    - dev
  - task: health-check
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/eks/dev-health-check.yaml
    vars:
      cluster_name: trading-eks
      namespace: truss_255
      project_name: category-v1
    input_mapping:
      ci-code: ci-code-TRUSS_255
    tags:
    - dev
  - try:
      put: jira-TRUSS_255
      params:
        action: comment
        comment:
          text: category-v1 deployed to dev environment.
        issue: TRUSS-255
      tags:
      - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_255/pipelines/tasks/eks/dev-deploy-slack-failure.yaml
    vars:
      branch: feature/TRUSS-255
      jira: TRUSS-255
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-255
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_255
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_255/pipelines/tasks/eks/dev-deploy-slack-success.yaml
    vars:
      branch: feature/TRUSS-255
      cluster_name: trading-eks
      jira: TRUSS-255
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-255
      namespace: truss_255
      project_name: category-v1
    tags:
    - dev
- name: merge-TRUSS_255
  public: true
  serial: true
  serial_groups:
  - release
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_255
        passed:
        - performance-test-TRUSS_255
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
  - task: feature-finish
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/maven/feature-finish.yaml
    vars:
      branch: feature/TRUSS-255
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_255
      code: code-TRUSS_255
    tags:
    - dev
    on_abort:
      task: prepare-slack-abort-message
      file: ci-code-TRUSS_255/pipelines/tasks/slack/general-abort.yaml
      vars:
        branch: feature/TRUSS-255
        project_name: category-v1
      tags:
      - dev
    on_failure:
      task: prepare-slack-failure-message
      file: ci-code-TRUSS_255/pipelines/tasks/maven/feature-finish-slack-failure.yaml
      vars:
        branch: feature/TRUSS-255
        jira: TRUSS-255
        jira_link: https://jira.willhillatlas.com/browse/TRUSS-255
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
    ensure:
      put: notify-TRUSS_255
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
    on_success:
      task: prepare-slack-success-message
      file: ci-code-TRUSS_255/pipelines/tasks/maven/feature-finish-slack-success.yaml
      vars:
        branch: feature/TRUSS-255
        jira: TRUSS-255
        jira_link: https://jira.willhillatlas.com/browse/TRUSS-255
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
    attempts: 2
- name: create-merge-request-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_255
        passed:
        - deploy-eks-TRUSS_255
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
  - task: create-merge-request
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/merge-requests/create.yaml
    vars:
      normalised_branch: truss_255
      project_api_url: https://git.nonprod.williamhill.plc/api/v4/projects/14071
      source_branch: feature/TRUSS-255
      target_branch: develop
      title: 'TRUSS-255: Deployed to EKS dev environment'
    input_mapping:
      ci-code: ci-code-TRUSS_255
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_255/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-255
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_255
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      do:
      - task: prepare-slack-success-message
        file: ci-code-TRUSS_255/pipelines/tasks/merge-requests/slack-success.yaml
        vars:
          branch: feature/TRUSS-255
          jira: TRUSS-255
          jira_link: https://jira.willhillatlas.com/browse/TRUSS-255
          project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_255
        params:
          attachments_file: slack/attachments
          channel: '#aws-heroes-mr'
          silent: true
          username: concourse
        tags:
        - dev
- name: release-TRUSS_255
  public: true
  serial: true
  serial_groups:
  - release
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_255
        passed:
        - merge-TRUSS_255
        trigger: true
        tags:
        - dev
      - get: code-develop-TRUSS_255
        tags:
        - dev
      - get: ci-code-TRUSS_255
        tags:
        - dev
      - get: base-image-TRUSS_255
        params:
          save: true
        tags:
        - dev
  - task: prepare-slack-start-message
    file: ci-code-TRUSS_255/pipelines/tasks/maven/release-start-slack.yaml
    vars:
      branch: feature/TRUSS-255
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  - put: notify-TRUSS_255
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  - task: release
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/maven/release.yaml
    vars:
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_255
      code: code-develop-TRUSS_255
    tags:
    - dev
  - try:
      task: code-analysis
      file: ci-code-TRUSS_255/pipelines/tasks/maven/sonar.yaml
      vars:
        version: master
      tags:
      - dev
  - put: app-image-master-TRUSS_255
    params:
      additional_tags: build/additional_tags
      build: build/code/category-v1-app
      cache_from:
      - base-image-TRUSS_255
      tag_as_latest: true
    tags:
    - dev
    on_abort:
      task: prepare-slack-abort-message
      file: ci-code-TRUSS_255/pipelines/tasks/slack/general-abort.yaml
      vars:
        branch: feature/TRUSS-255
        project_name: category-v1
      tags:
      - dev
    on_failure:
      task: prepare-slack-failure-message
      file: ci-code-TRUSS_255/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-255
        project_name: category-v1
      tags:
      - dev
    ensure:
      put: notify-TRUSS_255
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
    on_success:
      task: prepare-slack-success-message
      file: ci-code-TRUSS_255/pipelines/tasks/maven/release-finish-slack.yaml
      vars:
        branch: feature/TRUSS-255
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
- name: cleanup-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_255
        tags:
        - dev
      - get: code-TRUSS_255
        passed:
        - release-TRUSS_255
        trigger: true
        tags:
        - dev
  - task: cleanup-resources
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/cleanup/dev-cleanup-resources.yaml
    vars:
      chart_museum: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      chart_name: truss_255-trading-stack
      cluster_name: trading-eks
      docker_registry: https://nexus.dtc.prod.williamhill.plc:8443/repository/whc_docker/v2
      image_name: trading/category-v1-app-truss_255
      namespace: truss_255
    input_mapping:
      ci-code: ci-code-TRUSS_255
      code: code-TRUSS_255
    tags:
    - dev
  - task: cleanup-branches
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/cleanup/dev-cleanup-branches.yaml
    vars:
      branch: feature/TRUSS-255
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_255
      code: code-TRUSS_255
    tags:
    - dev
  on_abort:
    task: prepare-slack-abort-message
    file: ci-code-TRUSS_255/pipelines/tasks/slack/general-abort.yaml
    vars:
      branch: feature/TRUSS-255
      project_name: category-v1
    tags:
    - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_255/pipelines/tasks/cleanup/dev-cleanup-slack-failure.yaml
    vars:
      branch: feature/TRUSS-255
      jira: TRUSS-255
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-255
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_255
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_255/pipelines/tasks/slack/general-success.yaml
    vars:
      branch: feature/TRUSS-255
      project_name: category-v1
    tags:
    - dev
- name: build-code-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_245
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
      - get: metadata-TRUSS_245
        tags:
        - dev
  - task: prepare-slack-start-message
    file: ci-code-TRUSS_245/pipelines/tasks/maven/build-start-slack.yaml
    vars:
      branch: feature/TRUSS-245
      project_name: category-v1
    input_mapping:
      code: code-TRUSS_245
    tags:
    - dev
  - put: notify-TRUSS_245
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  - task: maven-build
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/maven/build.yaml
    input_mapping:
      code: code-TRUSS_245
      metadata: metadata-TRUSS_245
    tags:
    - dev
    attempts: 2
  - try:
      task: code-analysis
      file: ci-code-TRUSS_245/pipelines/tasks/maven/sonar.yaml
      vars:
        version: TRUSS-245
      tags:
      - dev
  on_abort:
    task: prepare-slack-abort-message
    file: ci-code-TRUSS_245/pipelines/tasks/slack/general-abort.yaml
    vars:
      branch: feature/TRUSS-245
      project_name: category-v1
    tags:
    - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_245/pipelines/tasks/slack/general-failure.yaml
    vars:
      branch: feature/TRUSS-245
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_245
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_245/pipelines/tasks/maven/build-finish-slack.yaml
    vars:
      branch: feature/TRUSS-245
      project_name: category-v1
    input_mapping:
      code: code-TRUSS_245
    tags:
    - dev
- name: security-scan-TRUSS_245
  public: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_245
        passed:
        - build-code-TRUSS_245
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
  - task: security-scan
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/security-scan.yaml
    input_mapping:
      code: code-TRUSS_245
    tags:
    - dev
- name: build-docker-image-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_245
        passed:
        - build-code-TRUSS_245
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
      - get: metadata-TRUSS_245
        tags:
        - dev
  - task: deploy
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/maven/deploy.yaml
    input_mapping:
      code: code-TRUSS_245
      metadata: metadata-TRUSS_245
    tags:
    - dev
  - get: base-image-TRUSS_245
    params:
      save: true
    tags:
    - dev
  - put: app-image-TRUSS_245
    params:
      additional_tags: output/additional_tags
      build: output/category-v1-app
      cache_from:
      - base-image-TRUSS_245
      tag_as_latest: true
    get_params:
      skip_download: true
    tags:
    - dev
  on_failure:
    do:
    - task: prepare-slack-failure-message
      file: ci-code-TRUSS_245/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-245
        project_name: category-v1
      tags:
      - dev
    - put: notify-TRUSS_245
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
- name: test-docker-image-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_245
        passed:
        - build-docker-image-TRUSS_245
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
      - get: app-image-TRUSS_245
        passed:
        - build-docker-image-TRUSS_245
        trigger: true
        params:
          save: true
        tags:
        - dev
  - task: test
    privileged: true
    file: code-TRUSS_245/ci/image-smoke-test.yaml
    vars:
      image-name: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_245:latest
    input_mapping:
      code: code-TRUSS_245
      image: app-image-TRUSS_245
    tags:
    - dev
  on_failure:
    do:
    - task: prepare-slack-failure-message
      file: ci-code-TRUSS_245/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-245
        project_name: category-v1
      tags:
      - dev
    - put: notify-TRUSS_245
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
- name: deploy-eks-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: app-image-TRUSS_245
        passed:
        - test-docker-image-TRUSS_245
        trigger: true
        tags:
        - dev
      - get: code-TRUSS_245
        passed:
        - test-docker-image-TRUSS_245
        tags:
        - dev
      - get: helm-TRUSS_245
        tags:
        - dev
      - get: trading-uber-chart-TRUSS_245
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
  - task: maven-version-TRUSS_245
    file: ci-code-TRUSS_245/pipelines/tasks/maven/version.yaml
    input_mapping:
      code: code-TRUSS_245
    tags:
    - dev
  - put: chartmuseum-TRUSS_245
    params:
      app_version_file: version/maven.version
      chart_path: helm-TRUSS_245/chart/category-v1
      child_of:
      - snapshots/truss_245-trading-stack:latest
      - releases/trading-stack:latest
      force: true
      rename_parent_to: truss_245-trading-stack
    tags:
    - dev
  - put: helm-chart-dry-run-TRUSS_245
    resource: helm-chart-TRUSS_245
    params:
      chart_name: truss_245-trading-stack
      chart_repo: snapshots
      debug: true
      dry_run: true
      namespace: truss_245
      namespace_labels:
        istio-injection: enabled
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_245
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_245
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_245
        category-v1.images.tag: latest
        global.cluster: trading-eks
        global.namespace: truss_245
      values_files:
      - trading-uber-chart-TRUSS_245/envs/dev/values.yaml
      version: latest
    tags:
    - dev
  - put: helm-chart-plan-TRUSS_245
    resource: helm-chart-TRUSS_245
    params:
      chart_name: truss_245-trading-stack
      chart_repo: snapshots
      namespace: truss_245
      namespace_labels:
        istio-injection: enabled
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_245
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_245
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_245
        category-v1.images.tag: latest
        global.cluster: trading-eks
        global.namespace: truss_245
      try_install: true
      values_files:
      - trading-uber-chart-TRUSS_245/envs/dev/values.yaml
      version: latest
    tags:
    - dev
  - put: helm-chart-apply-TRUSS_245
    resource: helm-chart-TRUSS_245
    params:
      chart_name: truss_245-trading-stack
      chart_repo: snapshots
      namespace: truss_245
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_245
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_245
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_245
        category-v1.images.tag: latest
      version: latest
    tags:
    - dev
  - task: health-check
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/eks/dev-health-check.yaml
    vars:
      cluster_name: trading-eks
      namespace: truss_245
      project_name: category-v1
    input_mapping:
      ci-code: ci-code-TRUSS_245
    tags:
    - dev
  - try:
      put: jira-TRUSS_245
      params:
        action: comment
        comment:
          text: category-v1 deployed to dev environment.
        issue: TRUSS-245
      tags:
      - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_245/pipelines/tasks/eks/dev-deploy-slack-failure.yaml
    vars:
      branch: feature/TRUSS-245
      jira: TRUSS-245
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-245
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_245
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_245/pipelines/tasks/eks/dev-deploy-slack-success.yaml
    vars:
      branch: feature/TRUSS-245
      cluster_name: trading-eks
      jira: TRUSS-245
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-245
      namespace: truss_245
      project_name: category-v1
    tags:
    - dev
- name: merge-TRUSS_245
  public: true
  serial: true
  serial_groups:
  - release
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_245
        passed:
        - performance-test-TRUSS_245
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
  - task: feature-finish
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/maven/feature-finish.yaml
    vars:
      branch: feature/TRUSS-245
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_245
      code: code-TRUSS_245
    tags:
    - dev
    on_abort:
      task: prepare-slack-abort-message
      file: ci-code-TRUSS_245/pipelines/tasks/slack/general-abort.yaml
      vars:
        branch: feature/TRUSS-245
        project_name: category-v1
      tags:
      - dev
    on_failure:
      task: prepare-slack-failure-message
      file: ci-code-TRUSS_245/pipelines/tasks/maven/feature-finish-slack-failure.yaml
      vars:
        branch: feature/TRUSS-245
        jira: TRUSS-245
        jira_link: https://jira.willhillatlas.com/browse/TRUSS-245
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
    ensure:
      put: notify-TRUSS_245
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
    on_success:
      task: prepare-slack-success-message
      file: ci-code-TRUSS_245/pipelines/tasks/maven/feature-finish-slack-success.yaml
      vars:
        branch: feature/TRUSS-245
        jira: TRUSS-245
        jira_link: https://jira.willhillatlas.com/browse/TRUSS-245
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
    attempts: 2
- name: create-merge-request-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_245
        passed:
        - deploy-eks-TRUSS_245
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
  - task: create-merge-request
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/merge-requests/create.yaml
    vars:
      normalised_branch: truss_245
      project_api_url: https://git.nonprod.williamhill.plc/api/v4/projects/14071
      source_branch: feature/TRUSS-245
      target_branch: develop
      title: 'TRUSS-245: Deployed to EKS dev environment'
    input_mapping:
      ci-code: ci-code-TRUSS_245
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_245/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-245
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_245
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      do:
      - task: prepare-slack-success-message
        file: ci-code-TRUSS_245/pipelines/tasks/merge-requests/slack-success.yaml
        vars:
          branch: feature/TRUSS-245
          jira: TRUSS-245
          jira_link: https://jira.willhillatlas.com/browse/TRUSS-245
          project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_245
        params:
          attachments_file: slack/attachments
          channel: '#aws-heroes-mr'
          silent: true
          username: concourse
        tags:
        - dev
- name: release-TRUSS_245
  public: true
  serial: true
  serial_groups:
  - release
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_245
        passed:
        - merge-TRUSS_245
        trigger: true
        tags:
        - dev
      - get: code-develop-TRUSS_245
        tags:
        - dev
      - get: ci-code-TRUSS_245
        tags:
        - dev
      - get: base-image-TRUSS_245
        params:
          save: true
        tags:
        - dev
  - task: prepare-slack-start-message
    file: ci-code-TRUSS_245/pipelines/tasks/maven/release-start-slack.yaml
    vars:
      branch: feature/TRUSS-245
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  - put: notify-TRUSS_245
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  - task: release
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/maven/release.yaml
    vars:
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_245
      code: code-develop-TRUSS_245
    tags:
    - dev
  - try:
      task: code-analysis
      file: ci-code-TRUSS_245/pipelines/tasks/maven/sonar.yaml
      vars:
        version: master
      tags:
      - dev
  - put: app-image-master-TRUSS_245
    params:
      additional_tags: build/additional_tags
      build: build/code/category-v1-app
      cache_from:
      - base-image-TRUSS_245
      tag_as_latest: true
    tags:
    - dev
    on_abort:
      task: prepare-slack-abort-message
      file: ci-code-TRUSS_245/pipelines/tasks/slack/general-abort.yaml
      vars:
        branch: feature/TRUSS-245
        project_name: category-v1
      tags:
      - dev
    on_failure:
      task: prepare-slack-failure-message
      file: ci-code-TRUSS_245/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-245
        project_name: category-v1
      tags:
      - dev
    ensure:
      put: notify-TRUSS_245
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
    on_success:
      task: prepare-slack-success-message
      file: ci-code-TRUSS_245/pipelines/tasks/maven/release-finish-slack.yaml
      vars:
        branch: feature/TRUSS-245
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
- name: cleanup-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_245
        tags:
        - dev
      - get: code-TRUSS_245
        passed:
        - release-TRUSS_245
        trigger: true
        tags:
        - dev
  - task: cleanup-resources
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/cleanup/dev-cleanup-resources.yaml
    vars:
      chart_museum: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      chart_name: truss_245-trading-stack
      cluster_name: trading-eks
      docker_registry: https://nexus.dtc.prod.williamhill.plc:8443/repository/whc_docker/v2
      image_name: trading/category-v1-app-truss_245
      namespace: truss_245
    input_mapping:
      ci-code: ci-code-TRUSS_245
      code: code-TRUSS_245
    tags:
    - dev
  - task: cleanup-branches
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/cleanup/dev-cleanup-branches.yaml
    vars:
      branch: feature/TRUSS-245
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_245
      code: code-TRUSS_245
    tags:
    - dev
  on_abort:
    task: prepare-slack-abort-message
    file: ci-code-TRUSS_245/pipelines/tasks/slack/general-abort.yaml
    vars:
      branch: feature/TRUSS-245
      project_name: category-v1
    tags:
    - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_245/pipelines/tasks/cleanup/dev-cleanup-slack-failure.yaml
    vars:
      branch: feature/TRUSS-245
      jira: TRUSS-245
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-245
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_245
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_245/pipelines/tasks/slack/general-success.yaml
    vars:
      branch: feature/TRUSS-245
      project_name: category-v1
    tags:
    - dev
- name: build-code-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_256
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
      - get: metadata-TRUSS_256
        tags:
        - dev
  - task: prepare-slack-start-message
    file: ci-code-TRUSS_256/pipelines/tasks/maven/build-start-slack.yaml
    vars:
      branch: feature/TRUSS-256
      project_name: category-v1
    input_mapping:
      code: code-TRUSS_256
    tags:
    - dev
  - put: notify-TRUSS_256
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  - task: maven-build
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/maven/build.yaml
    input_mapping:
      code: code-TRUSS_256
      metadata: metadata-TRUSS_256
    tags:
    - dev
    attempts: 2
  - try:
      task: code-analysis
      file: ci-code-TRUSS_256/pipelines/tasks/maven/sonar.yaml
      vars:
        version: TRUSS-256
      tags:
      - dev
  on_abort:
    task: prepare-slack-abort-message
    file: ci-code-TRUSS_256/pipelines/tasks/slack/general-abort.yaml
    vars:
      branch: feature/TRUSS-256
      project_name: category-v1
    tags:
    - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_256/pipelines/tasks/slack/general-failure.yaml
    vars:
      branch: feature/TRUSS-256
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_256
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_256/pipelines/tasks/maven/build-finish-slack.yaml
    vars:
      branch: feature/TRUSS-256
      project_name: category-v1
    input_mapping:
      code: code-TRUSS_256
    tags:
    - dev
- name: security-scan-TRUSS_256
  public: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_256
        passed:
        - build-code-TRUSS_256
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
  - task: security-scan
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/security-scan.yaml
    input_mapping:
      code: code-TRUSS_256
    tags:
    - dev
- name: build-docker-image-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_256
        passed:
        - build-code-TRUSS_256
        trigger: true
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
      - get: metadata-TRUSS_256
        tags:
        - dev
  - task: deploy
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/maven/deploy.yaml
    input_mapping:
      code: code-TRUSS_256
      metadata: metadata-TRUSS_256
    tags:
    - dev
  - get: base-image-TRUSS_256
    params:
      save: true
    tags:
    - dev
  - put: app-image-TRUSS_256
    params:
      additional_tags: output/additional_tags
      build: output/category-v1-app
      cache_from:
      - base-image-TRUSS_256
      tag_as_latest: true
    get_params:
      skip_download: true
    tags:
    - dev
  on_failure:
    do:
    - task: prepare-slack-failure-message
      file: ci-code-TRUSS_256/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-256
        project_name: category-v1
      tags:
      - dev
    - put: notify-TRUSS_256
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
- name: test-docker-image-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_256
        passed:
        - build-docker-image-TRUSS_256
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
      - get: app-image-TRUSS_256
        passed:
        - build-docker-image-TRUSS_256
        trigger: true
        params:
          save: true
        tags:
        - dev
  - task: test
    privileged: true
    file: code-TRUSS_256/ci/image-smoke-test.yaml
    vars:
      image-name: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_256:latest
    input_mapping:
      code: code-TRUSS_256
      image: app-image-TRUSS_256
    tags:
    - dev
  on_failure:
    do:
    - task: prepare-slack-failure-message
      file: ci-code-TRUSS_256/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-256
        project_name: category-v1
      tags:
      - dev
    - put: notify-TRUSS_256
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
- name: deploy-eks-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: app-image-TRUSS_256
        passed:
        - test-docker-image-TRUSS_256
        trigger: true
        tags:
        - dev
      - get: code-TRUSS_256
        passed:
        - test-docker-image-TRUSS_256
        tags:
        - dev
      - get: helm-TRUSS_256
        tags:
        - dev
      - get: trading-uber-chart-TRUSS_256
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
  - task: maven-version-TRUSS_256
    file: ci-code-TRUSS_256/pipelines/tasks/maven/version.yaml
    input_mapping:
      code: code-TRUSS_256
    tags:
    - dev
  - put: chartmuseum-TRUSS_256
    params:
      app_version_file: version/maven.version
      chart_path: helm-TRUSS_256/chart/category-v1
      child_of:
      - snapshots/truss_256-trading-stack:latest
      - releases/trading-stack:latest
      force: true
      rename_parent_to: truss_256-trading-stack
    tags:
    - dev
  - put: helm-chart-dry-run-TRUSS_256
    resource: helm-chart-TRUSS_256
    params:
      chart_name: truss_256-trading-stack
      chart_repo: snapshots
      debug: true
      dry_run: true
      namespace: truss_256
      namespace_labels:
        istio-injection: enabled
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_256
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_256
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_256
        category-v1.images.tag: latest
        global.cluster: trading-eks
        global.namespace: truss_256
      values_files:
      - trading-uber-chart-TRUSS_256/envs/dev/values.yaml
      version: latest
    tags:
    - dev
  - put: helm-chart-plan-TRUSS_256
    resource: helm-chart-TRUSS_256
    params:
      chart_name: truss_256-trading-stack
      chart_repo: snapshots
      namespace: truss_256
      namespace_labels:
        istio-injection: enabled
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_256
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_256
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_256
        category-v1.images.tag: latest
        global.cluster: trading-eks
        global.namespace: truss_256
      try_install: true
      values_files:
      - trading-uber-chart-TRUSS_256/envs/dev/values.yaml
      version: latest
    tags:
    - dev
  - put: helm-chart-apply-TRUSS_256
    resource: helm-chart-TRUSS_256
    params:
      chart_name: truss_256-trading-stack
      chart_repo: snapshots
      namespace: truss_256
      overrides:
        category-v1.app.kafkaOutputTopic: openbet-mapping-topic-truss_256
        category-v1.app.rmqInputQueue: gtp-endpoint-mapping-staging-queue-truss_256
        category-v1.images.repository: docker-registry.prod.williamhill.plc/trading/category-v1-app-truss_256
        category-v1.images.tag: latest
      version: latest
    tags:
    - dev
  - task: health-check
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/eks/dev-health-check.yaml
    vars:
      cluster_name: trading-eks
      namespace: truss_256
      project_name: category-v1
    input_mapping:
      ci-code: ci-code-TRUSS_256
    tags:
    - dev
  - try:
      put: jira-TRUSS_256
      params:
        action: comment
        comment:
          text: category-v1 deployed to dev environment.
        issue: TRUSS-256
      tags:
      - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_256/pipelines/tasks/eks/dev-deploy-slack-failure.yaml
    vars:
      branch: feature/TRUSS-256
      jira: TRUSS-256
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-256
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_256
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_256/pipelines/tasks/eks/dev-deploy-slack-success.yaml
    vars:
      branch: feature/TRUSS-256
      cluster_name: trading-eks
      jira: TRUSS-256
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-256
      namespace: truss_256
      project_name: category-v1
    tags:
    - dev
- name: merge-TRUSS_256
  public: true
  serial: true
  serial_groups:
  - release
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_256
        passed:
        - performance-test-TRUSS_256
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
  - task: feature-finish
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/maven/feature-finish.yaml
    vars:
      branch: feature/TRUSS-256
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_256
      code: code-TRUSS_256
    tags:
    - dev
    on_abort:
      task: prepare-slack-abort-message
      file: ci-code-TRUSS_256/pipelines/tasks/slack/general-abort.yaml
      vars:
        branch: feature/TRUSS-256
        project_name: category-v1
      tags:
      - dev
    on_failure:
      task: prepare-slack-failure-message
      file: ci-code-TRUSS_256/pipelines/tasks/maven/feature-finish-slack-failure.yaml
      vars:
        branch: feature/TRUSS-256
        jira: TRUSS-256
        jira_link: https://jira.willhillatlas.com/browse/TRUSS-256
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
    ensure:
      put: notify-TRUSS_256
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
    on_success:
      task: prepare-slack-success-message
      file: ci-code-TRUSS_256/pipelines/tasks/maven/feature-finish-slack-success.yaml
      vars:
        branch: feature/TRUSS-256
        jira: TRUSS-256
        jira_link: https://jira.willhillatlas.com/browse/TRUSS-256
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
    attempts: 2
- name: create-merge-request-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_256
        passed:
        - deploy-eks-TRUSS_256
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
  - task: create-merge-request
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/merge-requests/create.yaml
    vars:
      normalised_branch: truss_256
      project_api_url: https://git.nonprod.williamhill.plc/api/v4/projects/14071
      source_branch: feature/TRUSS-256
      target_branch: develop
      title: 'TRUSS-256: Deployed to EKS dev environment'
    input_mapping:
      ci-code: ci-code-TRUSS_256
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_256/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-256
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_256
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      do:
      - task: prepare-slack-success-message
        file: ci-code-TRUSS_256/pipelines/tasks/merge-requests/slack-success.yaml
        vars:
          branch: feature/TRUSS-256
          jira: TRUSS-256
          jira_link: https://jira.willhillatlas.com/browse/TRUSS-256
          project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_256
        params:
          attachments_file: slack/attachments
          channel: '#aws-heroes-mr'
          silent: true
          username: concourse
        tags:
        - dev
- name: release-TRUSS_256
  public: true
  serial: true
  serial_groups:
  - release
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: code-TRUSS_256
        passed:
        - merge-TRUSS_256
        trigger: true
        tags:
        - dev
      - get: code-develop-TRUSS_256
        tags:
        - dev
      - get: ci-code-TRUSS_256
        tags:
        - dev
      - get: base-image-TRUSS_256
        params:
          save: true
        tags:
        - dev
  - task: prepare-slack-start-message
    file: ci-code-TRUSS_256/pipelines/tasks/maven/release-start-slack.yaml
    vars:
      branch: feature/TRUSS-256
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  - put: notify-TRUSS_256
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  - task: release
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/maven/release.yaml
    vars:
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_256
      code: code-develop-TRUSS_256
    tags:
    - dev
  - try:
      task: code-analysis
      file: ci-code-TRUSS_256/pipelines/tasks/maven/sonar.yaml
      vars:
        version: master
      tags:
      - dev
  - put: app-image-master-TRUSS_256
    params:
      additional_tags: build/additional_tags
      build: build/code/category-v1-app
      cache_from:
      - base-image-TRUSS_256
      tag_as_latest: true
    tags:
    - dev
    on_abort:
      task: prepare-slack-abort-message
      file: ci-code-TRUSS_256/pipelines/tasks/slack/general-abort.yaml
      vars:
        branch: feature/TRUSS-256
        project_name: category-v1
      tags:
      - dev
    on_failure:
      task: prepare-slack-failure-message
      file: ci-code-TRUSS_256/pipelines/tasks/slack/general-failure.yaml
      vars:
        branch: feature/TRUSS-256
        project_name: category-v1
      tags:
      - dev
    ensure:
      put: notify-TRUSS_256
      params:
        attachments_file: slack/attachments
        silent: true
        username: concourse
      tags:
      - dev
    on_success:
      task: prepare-slack-success-message
      file: ci-code-TRUSS_256/pipelines/tasks/maven/release-finish-slack.yaml
      vars:
        branch: feature/TRUSS-256
        project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
        project_name: category-v1
      tags:
      - dev
- name: cleanup-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_256
        tags:
        - dev
      - get: code-TRUSS_256
        passed:
        - release-TRUSS_256
        trigger: true
        tags:
        - dev
  - task: cleanup-resources
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/cleanup/dev-cleanup-resources.yaml
    vars:
      chart_museum: http://chartmuseum.trading.aws-eu-west-1.dev.williamhill.plc/snapshots/trading
      chart_name: truss_256-trading-stack
      cluster_name: trading-eks
      docker_registry: https://nexus.dtc.prod.williamhill.plc:8443/repository/whc_docker/v2
      image_name: trading/category-v1-app-truss_256
      namespace: truss_256
    input_mapping:
      ci-code: ci-code-TRUSS_256
      code: code-TRUSS_256
    tags:
    - dev
  - task: cleanup-branches
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/cleanup/dev-cleanup-branches.yaml
    vars:
      branch: feature/TRUSS-256
      git_repo: git@git.nonprod.williamhill.plc:trading_development/trading_distribution/services/category-v1.git
    input_mapping:
      ci-code: ci-code-TRUSS_256
      code: code-TRUSS_256
    tags:
    - dev
  on_abort:
    task: prepare-slack-abort-message
    file: ci-code-TRUSS_256/pipelines/tasks/slack/general-abort.yaml
    vars:
      branch: feature/TRUSS-256
      project_name: category-v1
    tags:
    - dev
  on_failure:
    task: prepare-slack-failure-message
    file: ci-code-TRUSS_256/pipelines/tasks/cleanup/dev-cleanup-slack-failure.yaml
    vars:
      branch: feature/TRUSS-256
      jira: TRUSS-256
      jira_link: https://jira.willhillatlas.com/browse/TRUSS-256
      project_link: https://git.nonprod.williamhill.plc/trading_development/trading_distribution/services/category-v1
      project_name: category-v1
    tags:
    - dev
  ensure:
    put: notify-TRUSS_256
    params:
      attachments_file: slack/attachments
      silent: true
      username: concourse
    tags:
    - dev
  on_success:
    task: prepare-slack-success-message
    file: ci-code-TRUSS_256/pipelines/tasks/slack/general-success.yaml
    vars:
      branch: feature/TRUSS-256
      project_name: category-v1
    tags:
    - dev
- name: bdd-test-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_255
        tags:
        - dev
      - get: code-TRUSS_255
        passed:
        - deploy-eks-TRUSS_255
        trigger: true
        tags:
        - dev
      - get: bdd-test-pack-code-TRUSS_255
        tags:
        - dev
  - task: bdd-test
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/tests/services-test-pack.yaml
    vars:
      cluster_name: trading-eks
      namespace: truss_255
      project_name: category-v1
      resource: category/v1/categories/
    input_mapping:
      ci-code: ci-code-TRUSS_255
      code: bdd-test-pack-code-TRUSS_255
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_255/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-255
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_255
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      try:
        put: jira-TRUSS_255
        params:
          action: comment
          comment:
            text: category-v1 passed BDD test in dev environment.
          issue: TRUSS-255
        tags:
        - dev
- name: performance-test-TRUSS_255
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_255
        tags:
        - dev
      - get: code-TRUSS_255
        passed:
        - bdd-test-TRUSS_255
        trigger: true
        tags:
        - dev
      - get: performance-test-pack-code-TRUSS_255
        tags:
        - dev
  - task: performance-test
    privileged: true
    file: ci-code-TRUSS_255/pipelines/tasks/tests/services-performance-test.yaml
    vars:
      cluster_name: trading-eks
      gatling_report_bucket: category-v1
      namespace: truss_255
      project_name: category-v1
      resource: category/v1/categories/
    input_mapping:
      ci-code: ci-code-TRUSS_255
      code: performance-test-pack-code-TRUSS_255
    output_mapping:
      gatling: gatling
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_255/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-255
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_255
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      try:
        put: jira-TRUSS_255
        params:
          action: comment
          comment:
            text: category-v1 passed performance test in dev environment.
          issue: TRUSS-255
        tags:
        - dev
- name: bdd-test-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_256
        tags:
        - dev
      - get: code-TRUSS_256
        passed:
        - deploy-eks-TRUSS_256
        trigger: true
        tags:
        - dev
      - get: bdd-test-pack-code-TRUSS_256
        tags:
        - dev
  - task: smoke-test
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/tests/services-test-pack.yaml
    vars:
      cluster_name: trading-eks
      namespace: truss_256
      project_name: category-v1
      resource: category/v1/categories/
    input_mapping:
      ci-code: ci-code-TRUSS_256
      code: bdd-test-pack-code-TRUSS_256
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_256/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-256
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_256
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      try:
        put: jira-TRUSS_256
        params:
          action: comment
          comment:
            text: category-v1 passed BDD test in dev environment.
          issue: TRUSS-256
        tags:
        - dev
- name: performance-test-TRUSS_256
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_256
        tags:
        - dev
      - get: code-TRUSS_256
        passed:
        - bdd-test-TRUSS_256
        trigger: true
        tags:
        - dev
      - get: performance-test-pack-code-TRUSS_256
        tags:
        - dev
  - task: performance-test
    privileged: true
    file: ci-code-TRUSS_256/pipelines/tasks/tests/services-performance-test.yaml
    vars:
      cluster_name: trading-eks
      gatling_report_bucket: category-v1
      namespace: truss_256
      project_name: category-v1
      resource: category/v1/categories/
    input_mapping:
      ci-code: ci-code-TRUSS_256
      code: performance-test-pack-code-TRUSS_256
    output_mapping:
      gatling: gatling
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_256/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-256
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_256
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      try:
        put: jira-TRUSS_256
        params:
          action: comment
          comment:
            text: category-v1 passed performance test in dev environment.
          issue: TRUSS-256
        tags:
        - dev
- name: bdd-test-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_245
        tags:
        - dev
      - get: code-TRUSS_245
        passed:
        - deploy-eks-TRUSS_245
        trigger: true
        tags:
        - dev
      - get: bdd-test-pack-code-TRUSS_245
        tags:
        - dev
  - task: smoke-test
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/tests/services-test-pack.yaml
    vars:
      cluster_name: trading-eks
      namespace: truss_245
      project_name: category-v1
      resource: category/v1/categories/
    input_mapping:
      ci-code: ci-code-TRUSS_245
      code: bdd-test-pack-code-TRUSS_245
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_245/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-245
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_245
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      try:
        put: jira-TRUSS_245
        params:
          action: comment
          comment:
            text: category-v1 passed BDD test in dev environment.
          issue: TRUSS-245
        tags:
        - dev
- name: performance-test-TRUSS_245
  public: true
  serial: true
  build_logs_to_retain: 20
  plan:
  - in_parallel:
      steps:
      - get: ci-code-TRUSS_245
        tags:
        - dev
      - get: code-TRUSS_245
        passed:
        - bdd-test-TRUSS_245
        trigger: true
        tags:
        - dev
      - get: performance-test-pack-code-TRUSS_245
        tags:
        - dev
  - task: performance-test
    privileged: true
    file: ci-code-TRUSS_245/pipelines/tasks/tests/services-performance-test.yaml
    vars:
      cluster_name: trading-eks
      gatling_report_bucket: category-v1
      namespace: truss_245
      project_name: category-v1
      resource: category/v1/categories/
    input_mapping:
      ci-code: ci-code-TRUSS_245
      code: performance-test-pack-code-TRUSS_245
    output_mapping:
      gatling: gatling
    tags:
    - dev
    on_failure:
      do:
      - task: prepare-slack-failure-message
        file: ci-code-TRUSS_245/pipelines/tasks/slack/general-failure.yaml
        vars:
          branch: feature/TRUSS-245
          project_name: category-v1
        tags:
        - dev
      - put: notify-TRUSS_245
        params:
          attachments_file: slack/attachments
          silent: true
          username: concourse
        tags:
        - dev
    on_success:
      try:
        put: jira-TRUSS_245
        params:
          action: comment
          comment:
            text: category-v1 passed performance test in dev environment.
          issue: TRUSS-245
        tags:
        - dev
